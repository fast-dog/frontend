<table class="table table-striped tooltip-container dataTable sorted_table">
    <thead>
    <tr>
        <th class="col-sm-3">{{'Название'|_}}</th>
        <th class="col-sm-9">{{'Значение'|_}}</th>
        <th></th>
    </tr>
    <tr v-if="show_update_btn">
        <th colspan="3">
            <div class="ibox-title fixed-scroll" data-top="51">
                <a href="javascript:void(0)" class="ladda-button btn btn-default btn-xs" data-style="zoom-in"
                   v-on:click="update($event)">
                    <i class="fa fa-repeat"></i> {{'Обновить'|_}}
                </a>
            </div>
        </th>
    </tr>
    </thead>
    <tbody v-if="getProperties().length == 0">
    <tr>
        <td colspan="3" class="text-center">
            <p class="alert alert-info">
                <strong>{{'Для отображения свойст выберите категорию размещения'|_}}</strong>
            </p>
        </td>
    </tr>
    </tbody>
    <tbody v-for="(propertyParent,index) in getProperties()" :data-parent="index"
           v-if="getProperties().length > 0">
    <tr>
        <td colspan="3">
            <span class="muted" v-for="n in propertyParent.depth">&#9482;&nbsp;&nbsp;&nbsp;</span>
            <span v-if="propertyParent.depth >= 1">&ndash;&nbsp;</span>
            {{propertyParent.name}}
            (
            <router-link target="_blank"
                         :to="{name:'catalog_category_edit',params:{id:propertyParent.id}}"
                         v-html="'#' + propertyParent.id"></router-link>
            )
            : {{'свойств в категории'|_}}: {{propertyParent.children.length}}
        </td>
    </tr>
    <template v-for="(property,index) in propertyParent.children">
        <tr v-if="property.show_grouping">
            <td colspan="3">
                <a href="javascript:void(0)" v-on:click="toggleProperty(property)">
                    <i v-bind:class="{'fa-toggle-on': (!property.hidden),'fa-toggle-off': property.hidden}"
                       class="fa text-bold"></i> <strong>{{property.grouping_name}}</strong>
                </a>
                <div class="pull-right" v-if="property.grouping_id > 0">
                    <a href="javascript:void(0)"
                       class="pin"
                       v-on:click="toggleShowProperty(property)"
                       data-placement="top"
                       data-toggle="tooltip"
                       :title="'Зафиксировать отображение группы свойств в новом окне'|_">
                        <i class="fa fa-thumb-tack"
                           v-bind:class="{'active': property.pin == true}"></i></a>
                </div>
            </td>
        </tr>
        <template v-if="property.type == 'file' && property.type != 'html'">
            <tr>
                <td colspan="3">
                    <table class="table table-bordered" style="margin-bottom: 0px;">
                        <caption><strong>{{property.name}}</strong>
                            <strong class="text-danger text-bold" v-if="property.req == 1">*</strong>
                        </caption>
                        <tbody>
                        <tr v-for="(image, index) in property.value">
                            <td>
                                <div class="col-md-12">
                                    <input type="text"
                                           class="form-control" readonly style="cursor:pointer"
                                           v-on:click="openFinderMulti('image_'+index+'_'+property.id, property)"
                                           v-model="image.value" :id="'image_'+ index + '_' + property.id"
                                           :placeholder="'Выбор файла'|_">
                                    <span class="pull-right">
                                        <button type="button" data-style="zoom-in"
                                                style="position: absolute; top: 6px; right: 20px"
                                                v-on:click="deleteMediaItem(property, image, $event,index)"
                                                class="btn btn-xs btn-danger">
                                            {{'удалить'|_}}
                                            <i class="fa fa-trash" data-style="zoom-in"></i>
                                        </button>
                                    </span>
                                </div>
                            </td>
                            <td>
                                <input type="text" v-model="image.description" class="form-control"
                                       :placeholder="'Описание файла'|_">
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
        </template>
        <template v-if="property.type == 'html'">
            <tr v-if="!property.hidden">
                <td colspan="3">
                    <code-editor-form-field
                            :id="property.code"
                            :name="property.code"
                            :field="'value'"
                            :height="100"
                            :default_mode="'lazy'"
                            :label="property.name"
                            :model="property.value"
                            :required="(property.required != undefined) ? property.required : false"
                    >
                    </code-editor-form-field>
                </td>
            </tr>
        </template>
        <template v-if="property.type != 'file' && property.type != 'html'">
            <tr v-if="!property.hidden"
                v-bind:class="{'hidden':property.hidden,'broken-property': (property.value === undefined)}">
                <td>
                    <strong>{{property.name}}</strong>
                    <strong class="text-danger text-bold" v-if="property.is_search == 1">
                        <i class="fa fa-filter" data-toggle="tooltip"
                           :title="'Участвует в поиске'|_"></i>
                    </strong>
                    <strong class="text-danger text-bold" v-if="property.req == 1">*</strong>
                </td>
                <td>
                    <template v-if="property.value !== undefined">

                        <multiselect :value="property.value"
                                     v-if="(property.type == 'list' && property.data.multiple === false) ||
                                     (property.type == 'list' && property.data.multiple == undefined)"
                                     :options="property.default_value"
                                     :preselect-first="false"
                                     track-by="name"
                                     label="name"
                                     :multiple="false"
                                     @input="updatedSelectModel"
                                     @remove="removedSelectModel"
                                     :deselect-label="'Удалить значение'|_"
                                     :placeholder="'Выберите значение'|_"></multiselect>
                        <multiselect v-if="property.type == 'list' && property.data.multiple"
                                     :value="property.value"
                                     :options="property.default_value"
                                     :placeholder="'Выберите значение'|_"
                                     :preselect-first="false"
                                     track-by="name"
                                     label="name"
                                     :multiple="true"
                                     @input="updatedSelectMultipleModel"
                                     @remove="removedSelectMultipleModel"
                                     :deselect-label="'Удалить значение'|_"
                        ></multiselect>
                        <multiselect :value="property.value" v-if="property.type == 'exist'"
                                     :options="property.default_value"
                                     :preselect-first="false"
                                     :placeholder="'Выберите значение'|_"
                                     track-by="name"
                                     label="name"
                                     @input="updatedSelectModel"
                                     @remove="removedSelectModel"
                                     :deselect-label="'Удалить значение'|_">
                        </multiselect>
                        <data-source-form-field v-if="property.type == 'data_source'"
                                                :property="property"
                                                :is_calculate="is_calculate">
                        </data-source-form-field>

                        <input type="text"
                               v-on:keyup="textChange($event)"
                               class="form-control"
                               :data-id="property.id"
                               :value="property.value.value"
                               :placeholder="'Введите значение'|_"
                               :class="{'date':property.type == 'date'}"
                               v-if="property.type == 'string' || property.type == 'date'">

                        <input type="text" class="form-control"
                               :placeholder="'Введите число'|_"
                               :data-id="property.id"
                               v-on:keyup="textChange($event)"
                               :value="property.value"
                               :data-validate="'double'" v-if="property.type == 'number'">

                    </template>
                </td>
                <td></td>
            </tr>
        </template>
    </template>
    </tbody>
</table>